/*!
 * netrol.js v1.1.0-beta.1
 * Â© 2020-~ EuZen Chen
 * Released under the Anti 996 License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Netrol={})}(this,(function(t){"use strict";var e=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t};var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t};var s=function(t){if(Array.isArray(t))return t};var i=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,o=!1,s=void 0;try{for(var i,u=t[Symbol.iterator]();!(n=(i=u.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){o=!0,s=t}finally{try{n||null==u.return||u.return()}finally{if(o)throw s}}return r}};var u=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n};var a=function(t,e){if(t){if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}};var c=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var l=function(t,e){return s(t)||i(t,e)||a(t,e)||c()};var f,h=function(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}((function(t){function e(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=e=function(t){return typeof t}:t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(r)}t.exports=e}));function d(t){return null!==t&&"object"===h(t)}function p(t){return t&&t instanceof Function}function v(t){return FormData&&t instanceof FormData}function y(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function m(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,o=new Error(t);return o.type=e,o.ErrorType={STOP:f.STOP,FAIL:f.FAIL,THROTTLE:f.THROTTLE,STATUS:f.STATUS,TIMEOUT:f.TIMEOUT,CANCELED:f.CANCELED},e===f.STATUS&&(o.statusCode=n.code),o.toJSON=function(){var e={type:this.type,message:t,ErrorType:this.ErrorType};return void 0!==this.statusCode&&(e.statusCode=this.statusCode),e},r?Promise.reject(o):o}!function(t){t[t.STOP=0]="STOP",t[t.FAIL=1]="FAIL",t[t.THROTTLE=2]="THROTTLE",t[t.STATUS=3]="STATUS",t[t.TIMEOUT=4]="TIMEOUT",t[t.CANCELED=5]="CANCELED"}(f||(f={}));var g=new(function(){function t(){r(this,t),this.targets={}}return o(t,[{key:"catch",value:function(t,e){if(t=Number(t),y(this.targets,t))throw m("The catcher of status code ".concat(t," already exists"),f.FAIL);this.targets[t]=e}},{key:"trigger",value:function(t){return t=Number(t),!!y(this.targets,t)&&(this.targets[t](),!0)}},{key:"registerTimeoutHander",value:function(t){this.timeoutHander=t}}]),t}());var b=new(function(){function t(){r(this,t),this.upload={},this.download={}}return o(t,[{key:"add",value:function(t,e,r){if(y(this[t],e))throw m("The listener ".concat(e," already exists"),f.FAIL);this[t][e]=r}},{key:"trigger",value:function(t,e,r){p(this[t][e])&&this[t][e](r)}},{key:"isExist",value:function(t,e){return!!y(this[t],e)}}]),t}());function T(t,e,r){var n,o="upload"===t?r.upload:r;function s(r){b.trigger(t,e,{type:t,event:r,status:n.START,statusText:"start",ProgressStatus:n})}function i(r){b.trigger(t,e,{type:t,event:r,status:n.PROGRESS,statusText:"progress",ProgressStatus:n,total:r.total,loaded:r.loaded})}function u(r){b.trigger(t,e,{type:t,event:r,status:n.CANCEL,statusText:"cancel",ProgressStatus:n})}function a(r){b.trigger(t,e,{type:t,event:r,status:n.FAIL,statusText:"fail",ProgressStatus:n})}function c(r){b.trigger(t,e,{type:t,event:r,status:n.SUCCESS,statusText:"success",ProgressStatus:n})}function l(r){b.trigger(t,e,{type:t,event:r,status:n.TIMEOUT,statusText:"timeout",ProgressStatus:n})}function f(){o.removeEventListener("loadstart",s),o.removeEventListener("progress",i),o.removeEventListener("abort",u),o.removeEventListener("error",a),o.removeEventListener("load",c),o.removeEventListener("timeout",l),o.removeEventListener("loadend",f),o=null}r=null,function(t){t[t.FAIL=0]="FAIL",t[t.SUCCESS=1]="SUCCESS",t[t.PROGRESS=2]="PROGRESS",t[t.START=3]="START",t[t.CANCEL=4]="CANCEL",t[t.TIMEOUT=5]="TIMEOUT"}(n||(n={})),o.addEventListener("loadstart",s),o.addEventListener("progress",i),o.addEventListener("abort",u),o.addEventListener("error",a),o.addEventListener("load",c),o.addEventListener("timeout",l),o.addEventListener("loadend",f)}var O=new(function(){function t(){r(this,t),this.xhrPools={}}return o(t,[{key:"isExist",value:function(t){return!!this.xhrPools[t]}},{key:"cancel",value:function(t){return!!this.xhrPools[t]&&(this.xhrPools[t].abort(),!0)}},{key:"add",value:function(t,e){this.xhrPools[t]||(this.xhrPools[t]=e)}},{key:"remove",value:function(t){this.xhrPools[t]&&delete this.xhrPools[t]}}]),t}()),E=function(){function t(e,n,o){r(this,t),this.xhr=null,this.resolve=null,this.reject=null,this.requestConfig=null,this.requestConfig=e,this.resolve=n,this.reject=o}return o(t,[{key:"start",value:function(t){var e=this.requestConfig.name;O.add(e,t),b.isExist("upload",e)&&T("upload",e,t),b.isExist("download",e)&&T("download",e,t),this.xhr=t}},{key:"success",value:function(){O.remove(this.requestConfig.name);var t=function(t){var e=t.responseType&&"text"!==t.responseType?t.response:t.responseText;if("string"==typeof e)try{e=JSON.parse(e)}catch(t){}return{body:e,xhr:t,status:t.status,statusText:t.statusText}}(this.xhr);if(t.status>=200&&t.status<300)return this.resolve(t);g.trigger(t.status)?this.reject(m("Not an error; promise stop; https status ".concat(t.status," be catched"),f.STOP)):this.reject(m("request failed with status code ".concat(t.status),f.STATUS,!1,{code:t.status}))}},{key:"timeout",value:function(){var t=this.requestConfig,e=t.name,r=t.method,n=t.url,o=t.timeout,s=t.data;O.remove(e),g.timeoutHander&&g.timeoutHander({apiName:e,method:r,url:n,timeout:o,data:s}),this.reject(m("timeout of ".concat(o," ms exceeded"),f.TIMEOUT))}},{key:"error",value:function(){O.remove(this.requestConfig.name),this.reject(m("Network Error",f.FAIL))}},{key:"abort",value:function(){O.remove(this.requestConfig.name),this.reject(m("Request cancelled",f.CANCELED))}}]),t}();function S(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function P(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?S(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var j={"Content-Type":"application/json;charset=utf-8",Accept:"application/json, text/plain, */*"};function L(t){return t.headers=P(P({},j),t.headers),O.isExist(t.name)?m("Not an error; Triggered throttle;",f.THROTTLE,!0):new Promise((function(e,r){var n=new E(t,(function(t){return e(t)}),(function(t){return r(t)}));!function(t,e){var r=t.headers,n=t.method,o=t.url,s=t.data,i=t.timeout,u=new XMLHttpRequest;u.open(n,o,!0),s&&v(s)&&delete r["Content-Type"],Object.entries(r).forEach((function(t){var e=l(t,2),r=e[0],n=e[1];u.setRequestHeader(r,n)})),u.timeout=i,u.onreadystatechange=function(){u&&u.readyState===XMLHttpRequest.DONE&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&(e.success(),u=null)},u.ontimeout=function(){e.timeout(),u=null},u.onerror=function(){e.error(),u=null},u.onabort=function(){e.abort(),u=null},s||(s=null),e.start(u),u.send(s)}(t,n)}))}var w=new(function(){function t(){r(this,t),this.request=[],this.response=[]}return o(t,[{key:"req",value:function(t){this.request.push(t)}},{key:"res",value:function(t){this.response.push(t)}}]),t}());function x(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function A(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?x(Object(n),!0).forEach((function(r){e(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var C=function(){function t(e){r(this,t),this.apis={},this.parseOption(e)}return o(t,[{key:"parseOption",value:function(t,e,r){var n=this,o=t.apis,s=t.leach,i=t.module,u=t.config,a=void 0===u?{}:u,c=a.defaultMethod,l=a.baseUrl,h=a.timeout,d=a.headers;if(!o)throw m("apis is required in constructor",f.FAIL);Object.keys(o).forEach((function(t){var i=o[t],u=n.createApi(i,l||(null==r?void 0:r.baseUrl),c||(null==r?void 0:r.defaultMethod)||"get");u.headers=A(A({},null==r?void 0:r.headers),d),u.timeout=h||(null==r?void 0:r.timeout)||0,0===h&&(u.timeout=0),s&&s[t]&&(u.leach=s[t]),n.apis[e?"".concat(e,".").concat(t):t]=u})),i&&Object.keys(i).forEach((function(t){n.parseOption(i[t],t,a)}))}},{key:"createApi",value:function(t,e,r){return d(t)?{url:"".concat(e).concat(t.url),method:t.method.toLowerCase()}:{url:"".concat(e).concat(t),method:r.toLowerCase()}}},{key:"request",value:function(t,e){var r=this,n=this.apis[t];if(!n)return m("api ".concat(t," is not exist"),f.FAIL,!0);var o,s,i={name:t,data:e,headers:n.headers,method:n.method,url:n.url,timeout:n.timeout};i.data&&"get"===i.method&&(i.url=(o=i.url,s=e,o.includes("?")?Object.entries(s).forEach((function(t){var e=l(t,2),r=e[0],n=e[1];o+="&".concat(r,"=").concat(n)})):Object.entries(s).forEach((function(t,e){var r=l(t,2),n=r[0],s=r[1];o+=0===e?"?".concat(n,"=").concat(s):"&".concat(n,"=").concat(s)})),o),i.data=null);var u=[this.transformData,L];w.request.forEach((function(t){u.unshift(t)})),w.response.forEach((function(t){u.push((function(e){return t(e,r.stop)}))})),n.leach&&u.push((function(t){return n.leach(t,r.stop)}));for(var a=Promise.resolve(i);u.length;)a=a.then(u.shift());return a}},{key:"stop",value:function(){return m("Not an error; promise stop;",f.STOP,!0)}},{key:"transformData",value:function(t){var e,r=t.data;return"string"==typeof r||v(r)||(e=r,ArrayBuffer&&e instanceof ArrayBuffer)||function(t){return d(t)&&p(t.pipe)}(r)||function(t){return d(t)&&t instanceof File}(r)||function(t){return d(t)&&t instanceof Blob}(r)?Promise.resolve(t):d(r)?Promise.resolve(A(A({},t),{},{data:JSON.stringify(r)})):Promise.resolve(t)}}]),t}(),k=null;var I={request:function(t){return w.req(t),this},response:function(t){return w.res(t),this}};var q={upload:function(t,e){b.add("upload",t,e)},download:function(t,e){b.add("download",t,e)}};t.cancel=function(t){return O.cancel(t)},t.create=function(t){return k?console.warn("netrol instance is only"):(k=new C(t),function(t,e){return k.request(t,e)})},t.interceptor=I,t.progressListener=q,t.timeoutHander=function(t){if(g.timeoutHander)throw m("timeoutHander already exists",f.FAIL);g.registerTimeoutHander(t)},t.toCatch=function(t,e){g.catch(t,e)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=netrol.min.js.map
